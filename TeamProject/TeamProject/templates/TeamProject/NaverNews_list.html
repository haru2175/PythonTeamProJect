<!DOCTYPE html>
<html lang="en">
<head>
    <title>실시간 뉴스 속보</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% load static %}
</head>
<style>
    .pagination{
        --bs-pagination-hover-color: white;
        --bs-pagination-hover-bg: green;
        --bs-pagination-color: green;
    }
    #logo{
        margin-left: 220px;
    }
</style>
<body>
{% block content %}
<div class="container mt-3">
     <img id="logo" src="{% static 'images/logo.png' %}" alt="네이버">
    <p class="text-center mb-4">실시간 네이버 뉴스를 보다 편리하게 보실 수 있습니다.</p>

    <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
        <button type="button" class="btn btn-outline-success 전체" onclick="buttonCategory('전체')">전체</button>
        {% for news in NewsCategory %}
        <button type="button" class="btn btn-outline-success {{ news.nCategory }}" onclick="buttonCategory('{{ news.nCategory }}')">{{news.nCategory}}</button>
        {% endfor %}
        <div class="btn-group">
            <select class="btn btn-success" id="companySelect">
                <option>전체</option>
                {% for news in NewsCompany %}
                <option value="{{news.nCompany}}">{{news.nCompany}}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <button type="button" class="btn btn-success">최신 뉴스 새로고침</button>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>번호&nbsp;&nbsp;&nbsp;</th>
            <th>카테고리</th>
            <th>언론사&nbsp;&nbsp;&nbsp;</th>
            <th>기사 제목</th>
            <!--<th>출처</th>-->
        </tr>
        </thead>
        <tbody>
        {% for news in NaverNewsList %}
        <tr>
            <td>{{ news.nIdx }}</td>
            <td>{{ news.nCategory }}</td>
            <td>{{ news.nCompany }}</td>
            <td><a href="/NaverNews/view?idx={{news.nIdx}}"/> {{ news.nTitle }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <br/><br/>
</div>

<div class="btn-group-end" style="margin-left: 620px; padding: 10px;">
  <button type="button" class="btn btn-success">그래프로 보기</button>
  <button type="button" class="btn btn-success">워드클라우드</button>
</div>

<!-- 페이징 네비게이션 -->
<nav aria-label="Page navigation" class="my-4">
    <ul class="pagination justify-content-center">
        {% if has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page=1&{{query_params}}" aria-label="First">
                <span aria-hidden="true">&laquo;&laquo;</span>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{beginPage|add:-1}}&{{query_params}}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% endif %}


        <!--{'beginPage':beginPage, 'endPage':endPage, 'page_range':page_range}-->
        {% for i in page_range %}
        <li class="page-item"><a class="page-link" href="?page={{i}}&{{query_params}}">{{i}}</a></li>
        {% endfor %}

        {% if NaverNewsList.has_next %}
        <li class="page-item">
            <!-- 산술 연산을 수행하려면 add 템플릿 필터를 사용 -->
            <a class="page-link" href="?page={{endPage|add:1}}&{{query_params}}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{NaverNewsList.paginator.num_pages}}&{{query_params}}" aria-label="Last">
                <span aria-hidden="true">&raquo;&raquo;</span>
            </a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endblock %}

<script>
    var queryString = window.location.search;

    // URLSearchParams 객체를 생성한다.
    var urlParams = new URLSearchParams(queryString);

    // 특정 파라미터의 값을 가져온다
    var company = urlParams.get('company');
    var category = urlParams.get('category');

    // company의 값이 있으면 select option의 value를 지정해서 선택해준다.
    if(company != null) { $("#companySelect").val(company); }


    if(category == null){
        $(".btn-outline-success.전체").css({"--bs-btn-color": "#fff","--bs-btn-bg": "#198754","--bs-btn-border-color": "#198754","--bs-btn-hover-color": "#fff", "--bs-btn-hover-bg": "#157347", "--bs-btn-hover-border-color": "#146c43", "--bs-btn-focus-shadow-rgb": "60, 153, 110", "--bs-btn-active-color": "#fff", "--bs-btn-active-bg": "#146c43", "--bs-btn-active-border-color": "#13653f", "--bs-btn-active-shadow": "inset 0 3px 5px rgba(0, 0, 0, 0.125)", "--bs-btn-disabled-color": "#fff", "--bs-btn-disabled-bg": "#198754", "--bs-btn-disabled-border-color": "#198754" });
    } else {
        var containsSlash = category.includes("/");
        if(containsSlash){
            category =  category.replace("/", "\\/");
        }
        $("." + category + "").css({"--bs-btn-color": "#fff","--bs-btn-bg": "#198754","--bs-btn-border-color": "#198754","--bs-btn-hover-color": "#fff", "--bs-btn-hover-bg": "#157347", "--bs-btn-hover-border-color": "#146c43", "--bs-btn-focus-shadow-rgb": "60, 153, 110", "--bs-btn-active-color": "#fff", "--bs-btn-active-bg": "#146c43", "--bs-btn-active-border-color": "#13653f", "--bs-btn-active-shadow": "inset 0 3px 5px rgba(0, 0, 0, 0.125)", "--bs-btn-disabled-color": "#fff", "--bs-btn-disabled-bg": "#198754", "--bs-btn-disabled-border-color": "#198754" });
    }


    function buttonCategory(category) {
        if (company) {
            if(category == '전체'){
                window.location.href =  window.location.origin + '/NaverNews?company=' + company;
            } else{
                window.location.href =  window.location.origin + '/NaverNews?category=' + category + '&company=' + company;
            }
        }
        else {
            if(category == '전체'){
                window.location.href =  window.location.origin + '/NaverNews';
            } else{
                window.location.href =  window.location.origin + '/NaverNews?category=' + category;
            }
        }
    }

    $(document).ready(function() {
        $("#companySelect").on("change", function() {
            var company = $(this).val();
            if (category) {
                if(company == '전체'){
                    window.location.href =  window.location.origin + '/NaverNews?category=' + category;
                } else{
                    window.location.href =  window.location.origin + '/NaverNews?category=' + category + '&company=' + company;
                }
            }
            else {
                if(company == '전체'){
                    window.location.href =  window.location.origin + '/NaverNews';
                } else{
                    window.location.href =  window.location.origin + '/NaverNews?company=' + company;
                }
            }
        });
    });

</script>
</body>
</html>